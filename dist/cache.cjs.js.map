{"version":3,"file":"cache.cjs.js","sources":["../src/index.js"],"sourcesContent":["/**\n * @description 缓存生成器,对请求数据做缓存当重复请求的时候读取缓存而不是走http请求 当存满cache 的时候移除最少使用的cache\n */\n\nexport default class CacheController {\n    #size = 0;\n    #cacheBlob = new Map()\n    #useQuene ={}\n    #maxSize = 10\n    #maxUseTime = 3\n    constructor(props) {\n        this.#maxSize = props.maxSize\n        this.#maxUseTime = props.maxUseTime\n        this.axiosInstance =  props.axios;\n    }\n\n    setCache(key, blob) {\n        while (this.#size + blob.size > this.#maxSize && this.#size !== 0) {\n            this.removeEarliestCache()\n        }\n\n        this.#cacheBlob.set(key, blob)\n        this.#useQuene[key] = 0\n        this.#size += blob.size\n    }\n\n    haveCache(key) {\n        return this.#cacheBlob.has(key)\n    }\n\n    getCache(key) {\n        let cache = null\n        if (key in this.#useQuene) {\n            cache = this.#cacheBlob.get(key).data\n            this.#useQuene[key] += 1\n            if (this.#useQuene[key] >= this.#maxUseTime) {\n                this.deleteCache(key)\n            }\n        }\n        return cache\n    }\n\n    removeEarliestCache() {\n        const earliestUseKey = Object.keys(this.#useQuene).sort((a, b) => this.#useQuene[a] - this.#useQuene[b])[0]\n        delete this.#useQuene[earliestUseKey]\n        this.#size -= this.#cacheBlob.get(earliestUseKey).size\n        this.#cacheBlob.delete(earliestUseKey)\n    }\n\n    deleteCache(key) {\n        if (this.#cacheBlob.has(key)) {\n            delete this.#useQuene[key]\n            this.#size -= this.#cacheBlob.get(key).size\n            this.#cacheBlob.delete(key)\n        }\n    }\n}\n"],"names":["size","cacheBlob","Map","useQuene","maxSize","maxUseTime","constructor","props","this","axiosInstance","axios","setCache","key","blob","removeEarliestCache","set","haveCache","has","getCache","cache","get","data","deleteCache","earliestUseKey","Object","keys","sort","a","b","delete"],"mappings":"4BAIe,MACXA,GAAQ,EACRC,GAAa,IAAIC,IACjBC,GAAW,CAAE,EACbC,GAAW,GACXC,GAAc,EACdC,YAAYC,GACRC,MAAKJ,EAAWG,EAAMH,QACtBI,MAAKH,EAAcE,EAAMF,WACzBG,KAAKC,cAAiBF,EAAMG,KAC/B,CAEDC,SAASC,EAAKC,GACV,KAAOL,MAAKR,EAAQa,EAAKb,KAAOQ,MAAKJ,GAA2B,IAAfI,MAAKR,GAClDQ,KAAKM,sBAGTN,MAAKP,EAAWc,IAAIH,EAAKC,GACzBL,MAAKL,EAAUS,GAAO,EACtBJ,MAAKR,GAASa,EAAKb,IACtB,CAEDgB,UAAUJ,GACN,OAAOJ,MAAKP,EAAWgB,IAAIL,EAC9B,CAEDM,SAASN,GACL,IAAIO,EAAQ,KAQZ,OAPIP,KAAOJ,MAAKL,IACZgB,EAAQX,MAAKP,EAAWmB,IAAIR,GAAKS,KACjCb,MAAKL,EAAUS,IAAQ,EACnBJ,MAAKL,EAAUS,IAAQJ,MAAKH,GAC5BG,KAAKc,YAAYV,IAGlBO,CACV,CAEDL,sBACI,MAAMS,EAAiBC,OAAOC,KAAKjB,MAAKL,GAAWuB,MAAK,CAACC,EAAGC,IAAMpB,MAAKL,EAAUwB,GAAKnB,MAAKL,EAAUyB,KAAI,UAClGpB,MAAKL,EAAUoB,GACtBf,MAAKR,GAASQ,MAAKP,EAAWmB,IAAIG,GAAgBvB,KAClDQ,MAAKP,EAAW4B,OAAON,EAC1B,CAEDD,YAAYV,GACJJ,MAAKP,EAAWgB,IAAIL,YACbJ,MAAKL,EAAUS,GACtBJ,MAAKR,GAASQ,MAAKP,EAAWmB,IAAIR,GAAKZ,KACvCQ,MAAKP,EAAW4B,OAAOjB,GAE9B"}